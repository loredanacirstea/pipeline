!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.pipesource=t():n.pipesource=t()}(window,(function(){return function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(r,o,function(t){return n[t]}.bind(null,o));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=0)}([function(n,t,e){"use strict";function r(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function o(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?r(Object(e),!0).forEach((function(t){c(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):r(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function c(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function i(n){return function(n){if(Array.isArray(n)){for(var t=0,e=new Array(n.length);t<n.length;t++)e[t]=n[t];return e}}(n)||function(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(n){var t=JSON.parse(JSON.stringify(n)),e=t.rich_graph,r=t.runnable_graph,c=t.context,u={};Object.keys(e.n).forEach((function(n){var t=e.n[n],r="".concat(t.id,"_").concat(n);u[r]=JSON.parse(JSON.stringify(c[t.id])),e.n[n].id=r;var o=u[r].pfunction.gapi;o.inputs_idx=JSON.parse(JSON.stringify(o.inputs)),o.outputs_idx=JSON.parse(JSON.stringify(o.outputs))}));var a=r.length;return r.map((function(n,t){return n?n.map((function(n){var r=e.n[n];r.record=u[r.id];var c=r.record.pfunction.gapi.outputs.length,p=r.record.pfunction.gapi.inputs.length;return t<a-1&&(r.outputs=i(Array(c+1).keys()).slice(1).map((function(n){var t=r.out[n][0][0],c=r.out[n][0][1]-1,i=o({},r.record.pfunction.gapi.outputs[n-1],{name:u[e.n[t].id].pfunction.gapi.inputs[c].name});return i.name+="_".concat(t,"_").concat(c),u[e.n[t].id].pfunction.gapi.inputs_idx[c]=i,i}))),t>0&&(r.inputs=i(Array(p+1).keys()).slice(1).map((function(n){var t=r.in[n][0],c=r.in[n][1]-1,i=o({},r.record.pfunction.gapi.inputs[n-1],{name:u[e.n[t].id].pfunction.gapi.outputs[c].name});return i.name+="_".concat(t,"_").concat(c),u[e.n[t].id].pfunction.gapi.outputs_idx[c]=i,i}))),r})):null}))}function a(n){return function(n){if(Array.isArray(n)){for(var t=0,e=new Array(n.length);t<n.length;t++)e[t]=n[t];return e}}(n)||function(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}e.r(t);var p={pure:0,view:1,nonpayable:2,payable:3},s={0:"pure",1:"view",2:"nonpayable",3:"payable"},f=function(n){return function(t){return function(){var e,r,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"function00";if(!n)throw new Error("Language not available");if(0===t.runnable_graph.length)return{source:"",inputs:[],outputs:[]};var c=u(t),i=c.shift()||[],f=c.pop(),l=c.map((function(n){return n.filter((function(n){return"event"===n.record.pfunction.gapi.type}))})).reduce((function(n,t){return n.concat(t)}),[]);f[0].i<3e3&&(c.push(f),f=[]);var d=0;c.forEach((function(n){return n.map((function(n){var t=p[n.record.pfunction.gapi.stateMutability];t>d&&(d=t)}))}));var b,y={name:o,payable:!0,stateMutability:s[d],inputs:i.map((function(n){return n.record.pfunction.gapi.outputs_idx[0]})),outputs:f.map((function(n){return n.inputs[0]}))},m=n.fdefinition(y,"public"),g=(e=[]).concat.apply(e,a(c.map((function(t){return t.map(n.buildGraphStep)})))).join("\n");b=l.length>0&&n.buildFunctionWithEvents?n.buildFunctionWithEvents(y,g,f.map((function(n){return n.inputs[0]})),l):n.buildFunction(m,g,f.map((function(n){return n.inputs[0]})),l);var O=a(new Set((r=[]).concat.apply(r,a(c))).values()),v={};O.forEach((function(n){v[n.record.pclassid]||(v[n.record.pclassid]={pclass:n.record.pclass,fimports:[]}),v[n.record.pclassid].fimports.push(n.record)}));var j=n.buildImports(v,o),h=j+n.buildContainer(v,b,o);return{source:h,inputs:n.setTypes(i.map((function(n){return n.record.pfunction.gapi.outputs_idx[0]}))),outputs:n.setTypes(f.map((function(n){return n.inputs[0]}))),arguments:n.arguments(v)}}}};function l(n){return function(n){if(Array.isArray(n)){for(var t=0,e=new Array(n.length);t<n.length;t++)e[t]=n[t];return e}}(n)||function(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function b(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?d(Object(e),!0).forEach((function(t){y(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function y(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var m={name:"WEI_VALUE",type:"uint256",payable:!0},g={name:"done",type:"bool",temporary:!0},O=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"public",e=w(n.inputs),r=S(h(n.outputs)),o="non-payable"!==n.stateMutability?n.stateMutability:"",c=0===r.length?"":"returns (".concat(r.join(", "),")");return"function ".concat(n.name,"(").concat(e.join(", "),")\n    ").concat(t," ").concat(o,"\n    ").concat(c)},v=function(n){return n},j=function(n){var t=l(n),e=t.findIndex((function(n){return n.payable}));if(-1===e)return{inputs:t,weiValue:null};var r=t.splice(e,1)[0];return{inputs:t,weiValue:r}},h=function(n){return l(n).filter((function(n){return!n.temporary}))},w=function(n){return n.map((function(n){return"".concat(n.type," ").concat(n.name)}))},S=function(n){return n.map((function(n){return n.type}))},_=function(n){var t=n.map((function(n){return n.name}));return 0===t.length?"":"return ".concat(1===t.length?t[0]:"(".concat(t.join(", "),")"),";")},P={enrichAbi:function(n){var t=b({},n);return t.pfunction.gapi.inputs.find((function(n){return n.name===m.name}))?t:"event"===t.pfunction.gapi.type?(t.pfunction.gapi.outputs=JSON.parse(JSON.stringify(t.pfunction.gapi.inputs)),t.pfunction.gapi.inputs=[],t):(t.pfunction.gapi.payable&&t.pfunction.gapi.inputs.push(b({},m)),t.pfunction.gapi.outputs&&0===t.pfunction.gapi.outputs.length&&t.pfunction.gapi.outputs.push(b({},g)),t)},buildImports:function(n){var t=Object.keys(n).map((function(t){var e=n[t],r=e.pclass,o=e.fimports.map((function(n){var t=JSON.parse(JSON.stringify(n.pfunction.gapi));return t.inputs=j(t.inputs).inputs,O(t,"external")+";"}));return"interface ".concat(r.name,"Interface {\n  ").concat(o.join("\n  "),"\n}")}));return"pragma solidity ^0.5.4;\npragma experimental ABIEncoderV2;\n\n".concat(t.join("\n"),"\n")},buildContainer:function(n,t){var e=[],r=[],o=[];return Object.keys(n).forEach((function(t){var c=n[t].pclass,i="".concat(c.name,"Interface public ").concat(c.name,";"),u="address _".concat(c.name,"_address"),a="".concat(c.name," = ").concat(c.name,"Interface(_").concat(c.name,"_address);");e.push(i),r.push(u),o.push(a)})),"\n\ncontract PipedContract {\n  ".concat(e.join("\n  "),"\n\n  constructor(").concat(r.join(", "),") public {\n    ").concat(o.join("\n    "),"\n  }\n\n  ").concat(t,"\n}")},buildFunction:function(n,t,e){var r=_(h(e));return"".concat(n,"\n  {\n").concat(t,"\n    ").concat(r,"\n  }\n")},fdefinition:O,finputs:w,foutputs:S,buildGraphStep:function(n){var t=n.record,e=t.pfunction.gapi,r=j(n.inputs),o=r.inputs,c=r.weiValue,i=o.map((function(n){return n.name})),u=h(e.outputs_idx),a="";c&&e.payable&&(a=".value(".concat(c.name,")"));var p="".concat(t.pclass.name,".").concat(e.name).concat(a,"(").concat(i.join(", "),");");if(1===u.length)return"    ".concat(u[0].type," ").concat(u[0].name," = ").concat(p);var s=0===u.length?"":"(".concat(u.map((function(n){return"".concat(n.type," ").concat(n.name)})).join(", "),") = ");return"    ".concat(s).concat(p)},buildFout:_,setTypes:v,arguments:function(){return[]}};function x(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function A(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?x(Object(e),!0).forEach((function(t){E(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):x(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function E(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var J={name:"WEI_VALUE",type:"uint256",payable:!0},N={name:"done",type:"bool",temporary:!0},I=function(n){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=arguments.length>2?arguments[2]:void 0,e=n.inputs.map((function(n){return n.name})).concat(t);return"function ".concat(n.name,"(").concat(e.join(", "),")")},k=function(n){var t=JSON.parse(JSON.stringify(n)),e=t.findIndex((function(n){return n.payable}));if(-1===e)return{inputs:t,weiValue:null};var r=t.splice(e,1)[0];return{inputs:t,weiValue:r}},D=function(n){return JSON.parse(JSON.stringify(n)).filter((function(n){return!n.temporary}))},T=function(n){var t=n.map((function(n){return n.name}));return"return [".concat(t.join(", "),"];")},V={enrichAbi:function(n){var t=A({},n);return t.pfunction.gapi.inputs.find((function(n){return n.name===J.name}))?t:(t.pfunction.gapi.payable&&t.pfunction.gapi.inputs.push(A({},J)),0===t.pfunction.gapi.outputs.length&&t.pfunction.gapi.outputs.push(A({},N)),t)},buildImports:function(n,t){Object.keys(n).map((function(t){var e=n[t].pclass;return'"'.concat(e.deployment,'"')}));return""},buildContainer:function(n,t,e){var r=[],o=Object.keys(n).map((function(t){var e=n[t],o=e.pclass,c=e.fimports.map((function(n){var t=JSON.parse(JSON.stringify(n.pfunction.gapi));return t.inputs=k(t.inputs).inputs,t.outputs=D(t.outputs),delete t.outputs_idx,delete t.inputs_idx,t}));return r.push("address_".concat(o.name)),"\n  const abi_".concat(o.name," = ").concat(JSON.stringify(c),";\n  const ").concat(o.name," = new ethers.Contract(address_").concat(o.name,", abi_").concat(o.name,", signer);")}));return"function pipedGraph(".concat(r.join(", "),", provider, signer, ethers) {\n\n  ").concat(o.join("\n"),"\n\n  ").concat(t,"\n\n  return {").concat(e,"};\n}")},buildFunction:function(n,t,e,r){var o=T(e);return"async ".concat(n,"\n  {\n").concat(t,"\n    ").concat(o,"\n  }\n")},buildFunctionWithEvents:function(n,t,e,r){var o=I(n,null,["callback"]),c=r[0].record,i=c.pfunction.gapi,u=i.outputs_idx.map((function(n){return n.name})),a='"'.concat(i.name,"(").concat(i.outputs_idx.map((function(n){return n.type})).join(","),')"'),p="\n    const topics = [ethers.utils.id(".concat(a,")];\n    const filter = {address: ").concat(c.pclass.name,".address, topics};\n\n    provider.once(filter, async (result) => {\n      const {").concat(u.join(", "),"} = ethers.utils.defaultAbiCoder.decode(").concat(JSON.stringify(i.outputs_idx),", result.data);\n"),s="callback(".concat(e.map((function(n){return n.name})).join(", "),");");return"".concat(o,"\n  {\n    ").concat(p,"\n      ").concat(t,"\n      ").concat(s,"\n    });\n  }\n")},fdefinition:I,buildGraphStep:function(n,t){if("event"===n.record.pfunction.gapi.type)return"";var e=n.record,r=e.pfunction.gapi,o=k(n.inputs),c=o.inputs,i=o.weiValue,u=c.map((function(n){return n.name})),a=r.outputs_idx.map((function(n){return n.name})),p="";i&&r.payable&&(p=", {value: ".concat(i.name,"}"));var s,f="await ".concat(e.pclass.name,".").concat(r.name,"(").concat(u.join(", ")).concat(p,");");return s=1===a.length?"const ".concat(a[0]," = "):"const [".concat(a.join(", "),"] = "),"    ".concat(s).concat(f,"\n")},buildFout:T,setTypes:function(n){return n},arguments:function(n){return Object.keys(n).map((function(t){return n[t].pclass.deployment}))}};e.d(t,"enrichedGraphSteps",(function(){return u})),e.d(t,"sourceBuilder",(function(){return f})),e.d(t,"solidityBuilder",(function(){return P})),e.d(t,"web3Builder",(function(){return V}))}])}));